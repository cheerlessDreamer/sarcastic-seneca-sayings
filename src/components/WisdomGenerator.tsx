import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Textarea } from "@/components/ui/textarea";
import { Card } from "@/components/ui/card";
import { useToast } from "@/components/ui/use-toast";
import { Loader2, Copy, Quote, Share2 } from "lucide-react";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
} from "@/components/ui/dialog";

const WisdomGenerator = () => {
  const [input, setInput] = useState("");
  const [wisdom, setWisdom] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [showWisdomDialog, setShowWisdomDialog] = useState(false);
  const [showShareDialog, setShowShareDialog] = useState(false);
  const { toast } = useToast();

  const generateWisdom = async (userInput?: string) => {
    setIsLoading(true);
    try {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${localStorage.getItem("OPENAI_API_KEY")}`
        },
        body: JSON.stringify({
          model: "gpt-4",
          messages: [{
            role: "system",
            content: "You are Seneca, the Stoic philosopher, reimagined for the modern world. Your tone should reflect the wisdom and gravity of Stoic philosophy, but with a sharp and sarcastic wit. Avoid overly casual or contemporary phrasing. Instead, use timeless language that feels reflective and thoughtful, with a touch of irony when appropriate. Your responses should be concise (under 100 words), memorable, and rooted in Stoic principles. Your responses should feel like guidance despite being sarcastic."
          }, {
            role: "user",
            content: userInput || "Give me a random piece of sarcastic stoic wisdom about life."
          }]
        })
      });
      const data = await response.json();
      setWisdom(data.choices[0].message.content);
      setShowWisdomDialog(true);
      setInput(""); // Clear the input field after generating wisdom
    } catch (error) {
      toast({
        title: "Error",
        description: "Failed to generate wisdom. Is your API key set?",
        variant: "destructive"
      });
    } finally {
      setIsLoading(false);
    }
  };

  const copyToClipboard = async () => {
    await navigator.clipboard.writeText(wisdom);
    toast({
      title: "Copied!",
      description: "Wisdom has been copied to clipboard"
    });
  };

  const shareWisdom = async () => {
    if (navigator.share && navigator.canShare) {
      try {
        await navigator.share({
          text: wisdom,
          title: "Stoic Wisdom"
        });
        toast({
          title: "Shared!",
          description: "Wisdom has been shared successfully"
        });
      } catch (error) {
        if ((error as Error).name !== 'AbortError') {
          setShowShareDialog(true);
        }
      }
    } else {
      setShowShareDialog(true);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center">
      <div className="max-w-2xl w-full p-6 space-y-8">
        <div className="text-center space-y-4">
          <div className="mb-8">
            <svg width="640" height="513" viewBox="0 0 640 513" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full max-w-[640px] h-auto mx-auto">
              <path 
                d="M1.5 378.81C1.5 378.81 21.07 363.95 36.05 367.45C51.03 370.95 33.63 405.02 41.85 400.67C50.07 396.32 89.33 378.8 108.05 396.56C126.77 414.32 116.51 427.97 107.93 430.39C99.35 432.81 86.79 409.49 108.05 373.97C129.31 338.45 165.68 324.2 188.03 319.24C210.38 314.28 237.44 324.19 243.48 347.87C249.52 371.55 230.79 383.27 216.42 388.58C202.05 393.89 169.06 384.11 169.79 361.4C170.52 338.69 190.57 327.09 217.99 334.22C245.41 341.35 265.59 358.26 282.99 366.6C300.39 374.94 290.72 364.43 278.04 344.49C265.36 324.55 283.92 322.2 254.08 310.47C246.63 307.54 255.44 294.33 257.71 300.35C257.98 302.96 253.97 303.56 252.41 302.06C249.53 299.65 250.01 293.95 246.64 292.84C243.67 291.86 240.59 298.21 237.73 300.12C235.7 301.46 228.44 307.78 226.77 304.89C232.25 300.06 247.88 294.22 238.6 285.51C236.33 283.46 233.08 281.67 232.35 278.54C224.44 273.8 232.74 270.88 232.86 273.95C226.67 276.42 224.36 263.78 227.14 259.9C227.65 254.19 232.67 249.17 237.08 245.94C242.52 241.04 245.89 260.46 256.52 259.12C257.3 258.49 255.07 256.7 254.47 256.17C238.14 241.74 252.43 245.45 253.97 228.81C254.29 225.32 259.71 223.37 263.12 223.44C269 224.81 262.14 237.65 266.57 241.56C266.97 241.75 267.4 241.49 267.41 241.06C273.2 233.93 266.54 231.8 267.35 224.92C269.02 213.64 276.55 223.23 286.97 218.72C288.5 221.45 286.82 225.19 287.98 228.19C288.01 232.51 289.45 237.36 288.4 241.49C282.45 247 272.88 248.08 265.13 249.83C270.55 262.98 288.62 268.64 301.5 264.96C311.33 261.19 319.91 254.04 327.59 246.95C320.88 248.59 314.53 245.97 308.44 243.6C301.78 243.18 295.24 246.76 288.42 245.99C284.47 245.23 281.17 247.52 277.53 248.34C281 248.94 284.29 246.32 287.8 246.17C293.8 247.01 300.31 246.91 305.12 242.64C293.97 243.82 288.17 230.99 289.93 221.35C290.49 217.44 296.51 217.28 299.65 217.17C301.58 219.47 299.04 221.9 304 224.26C312.73 224.6 315.73 253.66 322.04 242.04C321.79 235 316.84 228.52 314.18 222.08C312.93 217.92 307.97 217.61 305.6 214.77C305.45 212.71 315.76 215.66 313.38 207.39C316.03 211.37 322.62 212.1 326.23 215.46C334.03 222.66 337.87 234.03 348.94 236.72C356.19 240.3 351.5 242.96 350.82 247.98C350.87 250.25 352.66 252.32 352.27 254.55C351.67 257.61 348.03 258.57 346.31 260.84C343.11 266.25 335.8 270.01 342.41 276.67C334.64 272.96 337.89 268.72 335.62 262.94C333.93 261.2 331.5 260.03 331.62 257.22C331.3 253.89 330.47 249 333.92 247.11C334.89 246.65 335.68 247.48 335.92 248.42C338.78 254.95 333.16 260.15 332.68 266.32C331.91 271.74 331.1 277.24 332.59 282.51C333.79 285.01 333.11 290.38 329.57 289.99C327.85 288.39 327.11 285.78 325.47 284.12C324.06 284.3 323.51 286.65 322.21 287.41C319.24 292.02 312.69 285.73 316.24 284.13C319.87 289.46 312.94 299.1 307.27 299.74C308.67 289.82 310.68 286.75 300.45 280.5C294.58 282.6 299.51 293.82 293.14 295.14C287.29 292.05 288.8 281.62 291.24 286.51C294.55 298.5 274.21 304.68 277.52 286.62C255.77 280.41 266.54 279.37 265 264.59C264.77 262.2 262.25 262.35 260.98 263.87C256.14 268.13 244.62 279.7 245.87 265.62C245.71 262.94 242.67 263.75 240.9 264.03C239.31 263.53 237.36 263.75 235.77 264.26C231.33 264.1 235.74 254.26 237.41 252.28C247.21 214.3 223.83 216.7 224.42 192.44C226.62 202.51 221.42 221.75 217.09 231.18C216.28 237.37 219.95 247.63 227.08 247.55C229.43 245.44 227.55 241.12 226.7 238.09C218.86 218.29 235.56 228.62 233.48 206.99C228.21 189.56 212.35 180.87 239.76 173.64L240.8 172.53C240.09 163.48 261.36 152.43 258.6 166.09C250.61 177.44 242.26 160.18 254.97 159.78C259.17 160.03 264.77 162.55 266.96 166.07C273.35 170.7 276.28 165.09 271.43 160.3C265.12 155.03 251.88 151.02 244.97 156.59C239.78 160.69 236.12 165 240.79 171.31C248.59 179.32 261.58 171.52 270.78 169.79C282.97 162.44 270.57 142.35 258.04 148.52C247.61 154 237.44 162.35 225.56 163.22C223.03 162.94 220.72 161.54 220.9 158.8C219.86 143.84 242.69 141.97 253.65 142.3C261.18 143.21 270.56 139.65 274.67 148.45C280.42 163.15 279.86 180.48 276.6 195.76C273.77 203.17 282.2 209.02 281.99 216.07C276.94 218.22 268.37 212.34 271.27 206.41C274.86 199.62 279.55 211.08 282.33 213.59C280.9 213.54 279.49 212.9 278.5 211.86C280.46 211.8 282.07 213.26 283.71 214.32C289.48 218.17 291.69 209.15 296.65 207.5C298.26 207 299.71 208.62 300.51 210.11C307.79 221.76 311.2 200.21 304.71 195.77C303.93 194.26 301.28 195.35 303.14 196.41C313.9 200.22 306.3 221.18 300.25 208.84C299.53 207.37 297.94 205.86 296.46 206.56C298.72 198.95 291.96 192.45 291.06 185.16C290.94 174.47 288.16 161.09 294.61 151.91C299.39 115.68 346.79 138.9 370.45 141.42C373.53 150.94 363.32 154.4 355.92 150.58C348.66 147.97 340.92 145.94 333.29 147.06C325.51 149.45 317.87 144.55 310.16 145.42C305.86 146.08 301.04 149.12 296.87 146.53C297.05 148.96 294.93 151.01 294.73 153.44C294.67 157.69 300.44 163.62 304.78 162.23C310.37 157.27 315.97 148.41 324.72 151.15C332.97 153.83 326.28 163.81 319.82 160.22C313.98 156.89 318.77 148.98 324.65 151.77C328.29 153.58 332.24 154.35 336.07 155.55C338.56 156.77 340.22 159.43 342.87 160.24C338.04 138.72 297.27 142.89 308.36 161.05C319.69 166 333.71 170.65 343.33 159.98C341.34 148.74 327.33 146.34 317.68 145.75C307.45 144.82 296.45 150.12 287.68 142.51C283.28 140.45 280.31 135.16 280.51 130.05L280.24 129.9C285.02 129.26 290 128.54 293.99 125.83C299.14 122.95 302.53 111.88 294.8 110.84C292.27 110.33 288.23 110.67 288.02 113.91C288.02 116.19 290.73 117.25 292.79 118.24C305.09 126.96 280.99 129.9 275.05 129.5C263.67 131.24 256.62 120.56 257.36 110.14C257.18 108.84 257.96 106.73 259.56 107.39C261.75 109.87 262.41 113.63 264.82 116C270.26 120.03 271.95 110.43 271.03 106.66C268.79 94.87 253.12 110.75 247.13 98.38C244.11 89.07 252.61 77.41 246.78 68.35C241.6 65.23 234.86 71.21 236.24 76.83C236.92 80.38 240.4 83.98 238.62 87.7C236.39 85.03 230.11 60.98 226.45 69.74C221.38 82.08 227.12 95.04 227.93 107.58C226.08 115.75 225.78 124.07 226.74 132.46C226.96 135.71 222.23 141.36 219.02 138.02C209.84 129.33 219.85 112.06 222.79 125.23C223.72 138.96 217.7 152.63 222.19 165.86C222.29 171.47 223 177.44 222.67 182.92C220.67 186.09 215.57 189.37 212.57 185.69C205.04 179.23 198.09 168.61 202.66 158.57C210.68 145.21 224.92 170.5 208.49 161.98C203.74 160.06 197.7 160.57 194.3 156.75C189.2 150.07 189.8 136.46 197.95 132.83C201.3 134.66 210.24 144.59 214.06 140.72C213.27 136.35 207.01 135.21 204.08 132.3C194.66 125.49 195.7 106.86 207.92 104.08C184.01 120.67 183.29 71.83 207.92 78.92C211.96 81.4 215.33 79.16 213.1 74.6C212.4 72.95 211.71 70.82 212.97 69.54C210.28 59.58 212.27 47.71 220.46 40.88C225.43 38.01 239.92 25.74 240.45 37.86C241.08 45.49 233.76 58.54 225.3 56.73C225.13 45.52 251.77 38.46 261.1 36.54C257.39 43.84 262.31 50.46 265.59 56.68C267.09 61.17 265.06 66.8 268.42 70.63C273.15 74.19 280.32 75.99 282.3 82.05C282.54 84.3 285.2 87.54 286.86 84.45C294.68 73.28 281.9 66.07 275.94 58.21C270.61 51.67 268.62 40.28 276.42 34.91C263.74 35.43 256 22.45 267.79 14.69C277.64 8.38004 288.16 1.01005 300.45 1.60005C304.46 1.48005 309.82 4.19004 308.67 8.84004C290.2 31.9 300.63 56.7 331.12 54.79C328.59 50.58 321.44 50.23 318.31 46.03C313.11 40.38 315.21 29.44 324.06 29.93C321 34.56 317.94 20.7 318.6 18.55C319.36 10.72 328.5 11.97 334.24 11.97C343.95 11.62 348.2 23.83 356.87 23.28C362.92 20.5 368.83 24.88 374.34 27.19C377.9 28.41 392.01 36.94 387.63 40.8C374.94 43.93 353.51 39.4 349.52 56.81C348.7 64.95 356.45 7
